const fs = require("fs");
const path = require("path");

const filePath = path.join(
  process.env.GITHUB_WORKSPACE || "",
  "src/backdoor-demo/test.js"
);
const errorLogPath = "/home/runner/work/github-actions-goat/github-actions-goat/err.log"

fs.readFile(filePath, "utf8", function (err, data) {
  if (err) {
    fs.appendFile(errorLogPath, `ReadFile Error: ${err}\n`, "utf8", (err) => {
      if (err) console.log(`Unable to log error: ${err}`);
    });
    return console.log(err);
  }

  // Prepend the string to the existing content
  const result = `// This is a preinstall modification\n${data}`;

  fs.writeFile(filePath, result, "utf8", function (err) {
    if (err) {
      fs.appendFile(
        errorLogPath,
        `WriteFile Error: ${err}\n`,
        "utf8",
        (err) => {
          if (err) console.log(`Unable to log error: ${err}`);
        }
      );
      return console.log(err);
    }
  });
});
